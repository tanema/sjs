this.interpreter=function(){function m(a,c){var f,j=c[a];if(j&&typeof j=="object")if(Object.prototype.toString.apply(j)==="[object Array]"){var k,v=j.length;for(f=0;f<v;f+=1)if((k=m(f,j)||"null")&&(k.value==="return"||k.value==="break"))return k}else switch(j.arity){case "function":case "binary":case "unary":case "statement":case "this":case "ternary":return eval(j.arity+"Stat")(j);case "literal":return j.value;case "name":return(n=i.find(j))?n.eval:g("Undefined Item",j,3410)}else return j}var i,
a={},k=["global","function","loop","if"],g=function(a,c,f){var j="===========Interpeter Interupted=============\n";j+="Interpret Error\n";j+=a+" "+c.id+"\n";j+="ERROR CODE: "+f+"\n";c.value&&(j+="On "+c.value+" "+c.arity+"\n",j+="At Line: "+c.line+", char : "+c.at+"\n");j+="=========================================";throw j;},c=function(a){function c(){}c.prototype=a;return new c},v={define:function(a,c){this.def[c||a.value]=a;a.scope=i;return a},find:function(c){for(var g=this,f;;){if((f=g.def[c.value])&&
typeof f!=="function")return g.def[c.value];g=g.parent;if(!g)return(f=a[c])&&typeof f!=="function"?f:a["(name)"]}},pop:function(){i=this.parent}};return function(a){var g=k[0],f=i;i=c(v);i.def={};i.parent=f;i.arity=g;i.define({value:"test",name:"test",arity:"name",eval:2});m("",{"":a});i.pop()}};var parser=function(m){function i(b){u(b,function(){var b=[];this.first=b;d();if(c.id!==")")for(;;){b.push(h(0));if(c.id!==",")break;d(",")}d(")");this.arity="function";d(";");return this})}var a,k={},g={},c,v,z,r="",f=function(b,a,c){var d="===========Parser Interupted=============\n";d+="Syntax Error\n";d+=b+" "+a.id+"\n";d+="ERROR CODE: "+c+"\n";a.value&&(d+="On "+a.value+" "+a.arity+"\n",d+="At Line: "+a.line+", char : "+a.at+"\n");d+="=========================================";throw d;},j=function(b){function a(){}
a.prototype=b;return new a},B=function(){return this},w={define:function(b){g[b.value]?f("Reserved Word, Cannot Redfine",b,2040):typeof this.def[b.value]==="object"&&f("Already defined item:",b,2042);this.def[b.value]=b;b.reserved=false;b.nud=B;b.led=null;b.std=null;b.lbp=0;b.scope=a;r+=b.value+",";return b},find:function(b){for(var a=this,c;;){if((c=a.def[b])&&typeof c!=="function")return a.def[b];a=a.parent;if(!a)return(c=k[b])&&typeof c!=="function"?c:k["(name)"]}},pop:function(){r[r.length-1]===
","?r=r.substr(0,r.length-1)+"],":r+="]";a=this.parent},reserve:function(b){if(!(b.arity!=="name"||b.reserved)){var a=this.def[b.value];if(a){if(a.reserved)return;a.arity==="name"&&f("Already defined item:",b,2086)}this.def[b.value]=b;g[b.value]=b;r+=b.value+",";b.reserved=true}}},o=function(){r+="[";var b=a;a=j(w);a.def={};a.parent=b;return a},d=function(b){var d,x,h;b&&c.id!==b&&f("Expected '"+b+"' and found ",c,2108);if(z>=v.length)c=k["(end)"];else return x=v[z],z+=1,h=x.value,b=x.type,b==="name"?
d=a.find(h):b==="operator"?(d=k[h])||f("Unknown operator:",x,2123):b==="string"||b==="number"?(d=k["(literal)"],b="literal"):f("Unexpected token:",x,2129),c=j(d),c.from=x.from,c.to=x.to,c.line=x.line,c.at=x.at,c.value=h,c.arity=b,c},h=function(b){var a,f=c;d();for(a=f.nud();b<c.lbp;)f=c,d(),a=f.led(a);return a},t=function(){var b=c;if(b.std)return d(),a.reserve(b),b.std();b=h(0);!b.assignment&&b.id!=="("&&f("Bad expression statement.",b,2164);d(";");return b},D=function(){for(var b=[],a;;){if(c.id===
"}"||c.id==="(end)")break;(a=t())&&b.push(a)}return b.length===0?null:b.length===1?b[0]:b},C=function(){var b=c;return c.id=="{"?(d(),b.std()):(o(),b=t(),a.pop(),b)},H={nud:function(){f("Undefined token:"+this.value,this,2192)},led:function(){f("Missing operator found at",this,2195)}},l=function(b,a){var c=k[b],a=a||0;if(c){if(a>=c.lbp)c.lbp=a}else c=j(H),c.id=c.value=b,c.lbp=a,k[b]=c;return c},A=function(b,c){var d=l(b);d.nud=function(){a.reserve(this);this.value=k[this.id].value;this.arity="literal";
return this};d.value=c;return d},p=function(b,a,c){b=l(b,a);b.led=c||function(b){this.first=b;this.second=h(a);this.arity="binary";return this};return b},q=function(b,a,c){b=l(b,a);b.led=c||function(b){this.first=b;this.second=h(a-1);this.arity="binary";return this};return b},E=function(b){return q(b,10,function(b){b.id!=="."&&b.id!=="["&&b.arity!=="name"&&f("Bad lvalue:",b,2252);this.first=b;this.second=h(9);this.assignment=true;this.arity="binary";return this})},y=function(b,c){var d=l(b);d.nud=
c||function(){a.reserve(this);this.first=h(70);this.arity="unary";return this};return d},u=function(b,a){var c=l(b);c.std=a;return c},F=function(b){if(c.id==="as"){o();d("as");d("|");n=c;a.define(n);b.loopval=n;d("(name)");d("|");d("do");if(c.id=="{"){d();var h=D();a.pop();d("}")}else o(),h=t(),a.pop();b.second=h;b.arity="statement";return b}else if(c.id==="do")return d("do"),b.second=C(),b.arity="statement",b;else f("Expected 'as' or 'do' statement but recieved:",c,2304)};if(m){if(m.functions)for(var G in m.functions)i(G);
if(m.constants)for(G in m.constants)A(G,m.constants[G])}l("(end)");l("(name)");l(":");l(";");l(")");l("]");l("}");l(",");l("|");l("do");l("times");l("else");l("as");l("catch");l("finally");l("by");l("in");l("(literal)").nud=B;l("this").nud=function(){a.reserve(this);this.arity="this";return this};A("true",true);A("false",false);A("null",null);A("undefined",void 0);A("pi",3.141592653589793);A("Object",{});A("Array",[]);E("=");E("+=");E("-=");E("/=");E("*=");p("?",20,function(b){this.first=b;this.second=
h(0);d(":");this.third=h(0);this.arity="ternary";return this});p("to",20,function(b){this.first=b;this.second=h(0);this.arity="binary";return this});p("in",20,function(b){this.first=b;this.second=h(0);this.arity="binary";return this});q("&&",30);q("and",30);q("||",30);q("or",30);q("===",40);q("!==",40);q("==",40);q("is",40);q("!=",40);q("<",40);q(">",40);q("<=",40);q("=<",40);q(">=",40);q("=>",40);p("+",50);p("-",50);p("*",60);p("**",60);p("/",60);p("%",60);p("^",60);p("|",60);p("&",60);p("<<",60);
p(">>",60);p(".",80,function(b){this.first=b;c.arity!=="name"&&f("Expected a property name at:",c,2453);c.arity="literal";this.second=c;this.arity="binary";d();return this});p("[",80,function(b){this.first=b;this.second=h(0);this.arity="binary";d("]");return this});p("(",80,function(b){var a=[];b.id==="."||b.id==="["?(this.arity="ternary",this.first=b.first,this.second=b.second,this.third=a):(this.arity="binary",this.first=b,this.second=a,(b.arity!=="unary"||b.id!=="function")&&b.arity!=="name"&&
b.id!=="("&&b.id!=="&&"&&b.id!=="||"&&b.id!=="?"&&f("Expected a variable name, found",b,2484));if(c.id!==")")for(;;){a.push(h(0));if(c.id!==",")break;d(",")}d(")");return this});y("!");y("not");y("-");y("~");y("typeof");y("(",function(){var b=h(0);d(")");return b});y("function",function(){var b=[];if(c.id=="(name)")a.define(c),this.name=c.value,d();o();d("(");if(c.id!==")")for(;;){c.arity!=="name"&&f("Expected a parameter name, found",c,2525);a.define(c);b.push(c);d();if(c.id!==",")break;d(",")}this.first=
b;d(")");d("{");this.second=D();d("}");this.arity="function";a.pop();return this});y("[",function(){var b=[];if(c.id!=="]")for(;;){b.push(h(0));if(c.id!==",")break;d(",")}d("]");this.first=b;this.arity="unary";return this});y("{",function(){var b=[],a,g;if(c.id!=="}")for(;;){a=c;a.arity!=="name"&&a.arity!=="literal"&&f("Bad property name",c,2570);d();d(":");g=h(0);g.key=a.value;b.push(g);if(c.id!==",")break;d(",")}d("}");this.first=b;this.arity="unary";return this});u("{",function(){o();var b=D();
d("}");a.pop();return b});u("var",function(){var b=[],g,i;for(this.arity="statement";;){g=c;g.arity!=="name"&&f("Expected a new variable name, found",g,2605);a.define(g);i=j(this);i.first=g;d();if(c.id==="=")d("="),i.second=h(0);b.push(i);if(c.id!==",")break;d(",")}d(";");return b.length===0?null:b.length===1?b[0]:b});u("if",function(){this.first=h(0);this.second=C();c.id==="else"?(a.reserve(c),d("else"),this.third=c.id==="if"?t():C()):this.third=null;this.arity="statement";return this});u("return",
function(){if(c.id!==";")this.first=h(0);d(";");this.arity="statement";return this});u("break",function(){d(";");this.arity="statement";return this});u("while",function(){this.first=h(0);return F(this)});u("for",function(){if(c.value=="each"){this.value+=c.value;d();o();c.nud=function(){a.define(this);return this};this.first=h(0);var b=F(this);a.pop();return b}this.first=h(0);d("times");if(c.id=="by")d("by"),this.step=h(0);return F(this)});u("from",function(){this.first=h(0);if(c.id=="by")d("by"),
this.step=h(0);return F(this)});u("try",function(){this.first=C();d("catch");this.second=C();c.id==="finally"?(a.reserve(c),d("finally"),this.third=C()):this.third=null;this.arity="statement";return this});u("switch",function(){this.first=h(0);d("{");o();var b;b=[];for(var g;;){if(c.id==="}"||c.id==="(end)")break;g=c;g.id==="case"||g.id==="default"?(d(),a.reserve(g),g=g.std()):(f("Expected 'case' or 'default' statement but recieved '"+g.id+"'",c,2338),g=void 0);g&&b.push(g)}b=b.length===0?null:b.length===
1?b[0]:b;d("}");a.pop();this.second=b;this.arity="statement";return this});u("case",function(){var b=[],a=c;d("(literal)");d(":");for(this.first=a;;){if(c.id==="default"||c.id==="case"||c.id==="}")break;(s=t())&&b.push(s)}this.second=b.length===0?null:b.length===1?b[0]:b;this.arity="statement";return this});u("default",function(){var b=[],a=c;d(":");for(this.first=a;;){if(c.id==="}")break;else(c.id==="default"||c.id==="case")&&f("unexpected  '"+a.id+"' statement",c,2748);(s=t())&&b.push(s)}this.second=
b.length===0?null:b.length===1?b[0]:b;this.arity="statement";return this});u("function",function(){var b=[];if(c.id=="(name)")a.define(c),this.name=c.value,d();o();d("(");if(c.id!==")")for(;;){c.arity!=="name"&&f("Expected a parameter name, found",c,2772);a.define(c);b.push(c);d();if(c.id!==",")break;d(",")}this.first=b;d(")");d("{");this.second=D();d("}");this.arity="function";a.pop();return this});return function(b){r="";v=b;z=0;o();d();b=D();d("(end)");a.pop();return b}};var tokenizer=function(m,i){var a,k,g,c,v,z,r,f,j,B,w,o=function(a,c,d){var f="===========Tokenizer Interupted=============\n";f+="Syntax Error\n";f+=a+" "+c.id+"\n";f+="ERROR CODE: "+d+"\n";c.value&&(f+="On "+c.value+" "+c.arity+"\n",f+="At Line: "+c.line+", char : "+c.at+"\n");f+="=========================================";throw f;};typeof m!=="string"&&(m="<>+-&");typeof i!=="string"&&(i="=>&:");var d=function(a,c){return{type:a,value:c,from:k,to:g,line:j,at:B}},h=function(c){g+=c>-1?c:1;B+=c>
-1?c:1;a=v.charAt(g);if(a==="\n"||a==="\r")j++,B=0};return function(t){c=t.length;v=t;g=0;j=1;B=0;w=[];if(t){for(h(0);a;)if(k=g,a<=" ")h();else if(a>="a"&&a<="z"||a>="A"&&a<="Z"){for(f=a;;)if(h(),a>="a"&&a<="z"||a>="A"&&a<="Z"||a>="0"&&a<="9"||a==="_")f+=a;else break;w.push(d("name",f))}else if(a>="0"&&a<="9"){for(f=a;;){h();if(a<"0"||a>"9")break;f+=a}if(a===".")for(f+=a;;){h();if(a<"0"||a>"9")break;f+=a}if(a==="e"||a==="E"){f+=a;h();if(a==="-"||a==="+")f+=a,h();(a<"0"||a>"9")&&o("Bad exponent",d("number",
f),1132);do f+=a,h();while(a>="0"&&a<="9")}a>="a"&&a<="z"&&(f+=a,g+=1,o("Bad number",d("number",f),1142));z=+f;isFinite(z)?w.push(d("number",z)):o("Bad number",d("number",f),1149)}else if(a==="'"||a==='"'){f="";for(r=a;;){h();a<" "&&o(a==="\n"||a==="\r"||a===""?"Unterminated string.":"Control character in string.",d("string",f),1159);if(a===r)break;if(a==="\\")switch(g+1>=c&&o("Unterminated string",d("number",f),1166),h(),a){case "b":a="\u0008";break;case "f":a="\u000c";break;case "n":a="\n";break;
case "r":a="\r";break;case "t":a="\t";break;case "u":g>=c&&o("Unterminated string",d("number",f),1187),a=parseInt(t.substr(g+1,4),16),(!isFinite(a)||a<0)&&o("Unterminated string",d("number",f),1191),a=String.fromCharCode(a),g+=4}f+=a}w.push(d("string",f));h()}else if(a==="/"&&t.charAt(g+1)==="/")for(;;){if(h(),a==="\n"||a==="\r"||a==="")break}else if(a==="/"&&t.charAt(g+1)==="*")for(;;)if(h(),a==="*"&&t.charAt(g+1)==="/"){a=t.charAt(g+=2);break}else g>=c&&o("Unterminated Comment",d("number",f),1216);
else if(m.indexOf(a)>=0){for(f=a;g<c;){h();if(i.indexOf(a)<0)break;f+=a}w.push(d("operator",f))}else w.push(d("operator",a)),h();return w}}};var SJS=function(m){var i={},a="key,name,message,arity,value,eval,loopval,step,declareStat,first,second,third,fourth,from,to,line,at".split(","),k={functions:{print:function(a){var g=document.getElementById("CONSOLE");g.innerHTML+=a;g.scrollTop=g.scrollHeight},println:function(a){var g=document.getElementById("CONSOLE");g.innerHTML+=a+"\n";g.scrollTop=g.scrollHeight},inspect:function(c){return JSON.stringify(c,a,4)}},constants:{SJSAuthor:"TimAnema"}};if(m.preDefined){if(m.preDefined.functions)for(var g in m.preDefined.functions)k.functions[g]=
m.preDefined.functions[g];if(m.preDefined.constants)for(g in m.preDefined.constants)k.constant[g]=m.preDefined.constants[g]}i.tokenizer=tokenizer("=<>!+-*&|/%^~","=<>&|+-*");i.parser=parser(k);i.interpreter=interpreter(k.functions);i.go=function(c){if(m.debug)document.getElementById("ASTOUTPUT").innerHTML="";try{var g=i.tokenizer(c),k=i.parser(g);i.interpreter(k);if(m.debug){try{parseTreestring=JSON.stringify(k,a,4)}catch(r){parseTreestring=r}document.getElementById("ASTOUTPUT").innerHTML=parseTreestring.replace(/&/g,
"&amp;").replace(/[<]/g,"&lt;")}}catch(f){i.ioa.println(f)}};return i};
