this.interpreter=function(f){function k(c,j){var f,h=j[c];if(h&&typeof h=="object")if(Object.prototype.toString.apply(h)==="[object Array]"){var d,g=h.length;for(f=0;f<g;f+=1)if((d=k(f,h)||"null")&&(d.value==="return"||d.value==="break"))return d}else switch(h.arity){case "function":case "binary":case "unary":case "statement":case "this":case "ternary":return eval(h.arity+"Stat")(h);case "literal":return h.value;case "name":return(n=a.find(h))?n.eval:q("Undefined Item",h,3410)}else return h}var a,
c={},i=["global","function","loop","if"],q=function(c,a,f){var h="===========Interpeter Interupted=============\n";h+="\n";h+="Interpret Error\n";h+=c+"\n";h+="ERROR CODE: "+f+"\n";a.value&&(h+="On "+a.value+" "+a.arity+"\n",h+="At Line: "+a.line+", char : "+a.at+"\n");throw h;},r=function(c){function a(){}a.prototype=c;return new a},l={define:function(c,f){this.def[f||c.value]=c;c.scope=a;return c},find:function(a){for(var f=this,i;;){if((i=f.def[a.value])&&typeof i!=="function")return f.def[a.value];
f=f.parent;if(!f)return(i=c[a])&&typeof i!=="function"?i:c["(name)"]}},pop:function(){a=this.parent}};return function(c){f.println("==============INIT Interpeter================\n");var j=i[0],q=a;a=r(l);a.def={};a.parent=q;a.arity=j;k("",{"":c});a.pop();f.println("\n==============END Interpeter=================")}};var parser=function(){var f,k={},a={},c,i,q,r="",l=function(b,c,a){var d="===========Parser Interupted=============\n";d+="\n";d+="Syntax Error\n";d+=b+"\n";d+="ERROR CODE: "+a+"\n";c.value&&(d+="On "+c.value+" "+c.arity+"\n",d+="At Line: "+c.line+", char : "+c.at+"\n");throw d;},y=function(b){function c(){}c.prototype=b;return new c},j=function(){return this},A={define:function(b){a[b.value]?l("Reserved Word, Cannot Redfine",b,2040):typeof this.def[b.value]==="object"&&l("Already defined item:",
b,2042);this.def[b.value]=b;b.reserved=false;b.nud=j;b.led=null;b.std=null;b.lbp=0;b.scope=f;r+=b.value+",";return b},find:function(b){for(var c=this,a;;){if((a=c.def[b])&&typeof a!=="function")return c.def[b];c=c.parent;if(!c)return(a=k[b])&&typeof a!=="function"?a:k["(name)"]}},pop:function(){r[r.length-1]===","?r=r.substr(0,r.length-1)+"],":r+="]";f=this.parent},reserve:function(b){if(!(b.arity!=="name"||b.reserved)){var c=this.def[b.value];if(c){if(c.reserved)return;c.arity==="name"&&l("Already defined item:",
b,2086)}this.def[b.value]=b;a[b.value]=b;r+=b.value+",";b.reserved=true}}},h=function(){r+="[";var b=f;f=y(A);f.def={};f.parent=b;return f},d=function(b){var a,d,g;b&&c.id!==b&&l("Expected '"+b+"' and found",c,2108);if(q>=i.length)c=k["(end)"];else return d=i[q],q+=1,g=d.value,b=d.type,b==="name"?a=f.find(g):b==="operator"?(a=k[g])||l("Unknown operator:",d,2123):b==="string"||b==="number"?(a=k["(literal)"],b="literal"):l("Unexpected token:",d,2129),c=y(a),c.from=d.from,c.to=d.to,c.line=d.line,c.at=
d.at,c.value=g,c.arity=b,c},g=function(b){var a,f=c;d();for(a=f.nud();b<c.lbp;)f=c,d(),a=f.led(a);return a},p=function(){var b=c;if(b.std)return d(),f.reserve(b),b.std();b=g(0);!b.assignment&&b.id!=="("&&l("Bad expression statement.",b,2164);d(";");return b},o=function(){for(var b=[],a;;){if(c.id==="}"||c.id==="(end)")break;(a=p())&&b.push(a)}return b.length===0?null:b.length===1?b[0]:b},v=function(){var b=c;return c.id=="{"?(d(),b.std()):(h(),b=p(),f.pop(),b)},D={nud:function(){l("Undefined token:"+
this.value,this,2192)},led:function(){l("Missing operator found at",this,2195)}},m=function(b,c){var a=k[b],c=c||0;if(a){if(c>=a.lbp)a.lbp=c}else a=y(D),a.id=a.value=b,a.lbp=c,k[b]=a;return a},z=function(b,a){var c=m(b);c.nud=function(){f.reserve(this);this.value=k[this.id].value;this.arity="literal";return this};c.value=a;return c},t=function(b,a,c){b=m(b,a);b.led=c||function(b){this.first=b;this.second=g(a);this.arity="binary";return this};return b},u=function(b,a,c){b=m(b,a);b.led=c||function(b){this.first=
b;this.second=g(a-1);this.arity="binary";return this};return b},B=function(b){return u(b,10,function(b){b.id!=="."&&b.id!=="["&&b.arity!=="name"&&l("Bad lvalue:",b,2252);this.first=b;this.second=g(9);this.assignment=true;this.arity="binary";return this})},x=function(b,a){var c=m(b);c.nud=a||function(){f.reserve(this);this.first=g(70);this.arity="unary";return this};return c},w=function(b,a){var c=m(b);c.std=a;return c},C=function(b){if(c.id==="as"){h();d("as");d("|");n=c;f.define(n);b.loopval=n;d("(name)");
d("|");d("do");if(c.id=="{"){d();var a=o();f.pop();d("}")}else h(),a=p(),f.pop();b.second=a;b.arity="statement";return b}else if(c.id==="do")return d("do"),b.second=v(),b.arity="statement",b;else l("Expected 'as' or 'do' statement but recieved:",c,2304)};m("(end)");m("(name)");m(":");m(";");m(")");m("]");m("}");m(",");m("|");m("do");m("times");m("else");m("as");m("catch");m("finally");m("by");m("in");m("(literal)").nud=j;m("this").nud=function(){f.reserve(this);this.arity="this";return this};z("true",
true);z("false",false);z("null",null);z("undefined",void 0);z("pi",3.141592653589793);z("Object",{});z("Array",[]);B("=");B("+=");B("-=");B("/=");B("*=");t("?",20,function(b){this.first=b;this.second=g(0);d(":");this.third=g(0);this.arity="ternary";return this});t("to",20,function(b){this.first=b;this.second=g(0);this.arity="binary";return this});t("in",20,function(b){this.first=b;this.second=g(0);this.arity="binary";return this});u("&&",30);u("and",30);u("||",30);u("or",30);u("===",40);u("!==",40);
u("==",40);u("is",40);u("!=",40);u("<",40);u(">",40);u("<=",40);u("=<",40);u(">=",40);u("=>",40);t("+",50);t("-",50);t("*",60);t("**",60);t("/",60);t("%",60);t("^",60);t("|",60);t("&",60);t("<<",60);t(">>",60);t(".",80,function(b){this.first=b;c.arity!=="name"&&l("Expected a property name at:",c,2453);c.arity="literal";this.second=c;this.arity="binary";d();return this});t("[",80,function(b){this.first=b;this.second=g(0);this.arity="binary";d("]");return this});t("(",80,function(b){var a=[];b.id===
"."||b.id==="["?(this.arity="ternary",this.first=b.first,this.second=b.second,this.third=a):(this.arity="binary",this.first=b,this.second=a,(b.arity!=="unary"||b.id!=="function")&&b.arity!=="name"&&b.id!=="("&&b.id!=="&&"&&b.id!=="||"&&b.id!=="?"&&l("Expected a variable name, found",b,2484));if(c.id!==")")for(;;){a.push(g(0));if(c.id!==",")break;d(",")}d(")");return this});x("!");x("not");x("-");x("~");x("typeof");x("(",function(){var b=g(0);d(")");return b});x("function",function(){var b=[];if(c.id==
"(name)")f.define(c),this.name=c.value,d();h();d("(");if(c.id!==")")for(;;){c.arity!=="name"&&l("Expected a parameter name, found",c,2525);f.define(c);b.push(c);d();if(c.id!==",")break;d(",")}this.first=b;d(")");d("{");this.second=o();d("}");this.arity="function";f.pop();return this});x("[",function(){var b=[];if(c.id!=="]")for(;;){b.push(g(0));if(c.id!==",")break;d(",")}d("]");this.first=b;this.arity="unary";return this});x("{",function(){var b=[],a,f;if(c.id!=="}")for(;;){a=c;a.arity!=="name"&&
a.arity!=="literal"&&l("Bad property name",c,2570);d();d(":");f=g(0);f.key=a.value;b.push(f);if(c.id!==",")break;d(",")}d("}");this.first=b;this.arity="unary";return this});w("{",function(){h();var b=o();d("}");f.pop();return b});w("var",function(){var b=[],a,i;for(this.arity="statement";;){a=c;a.arity!=="name"&&l("Expected a new variable name, found",a,2605);f.define(a);i=y(this);i.first=a;d();if(c.id==="=")d("="),i.second=g(0);b.push(i);if(c.id!==",")break;d(",")}d(";");return b.length===0?null:
b.length===1?b[0]:b});w("if",function(){this.first=g(0);this.second=v();c.id==="else"?(f.reserve(c),d("else"),this.third=c.id==="if"?p():v()):this.third=null;this.arity="statement";return this});w("return",function(){if(c.id!==";")this.first=g(0);d(";");this.arity="statement";return this});w("break",function(){d(";");this.arity="statement";return this});w("while",function(){this.first=g(0);return C(this)});w("for",function(){if(c.value=="each"){this.value+=c.value;d();h();c.nud=function(){f.define(this);
return this};this.first=g(0);var b=C(this);f.pop();return b}this.first=g(0);d("times");if(c.id=="by")d("by"),this.step=g(0);return C(this)});w("from",function(){this.first=g(0);if(c.id=="by")d("by"),this.step=g(0);return C(this)});w("try",function(){this.first=v();d("catch");this.second=v();c.id==="finally"?(f.reserve(c),d("finally"),this.third=v()):this.third=null;this.arity="statement";return this});w("switch",function(){this.first=g(0);d("{");h();var b;b=[];for(var a;;){if(c.id==="}"||c.id==="(end)")break;
a=c;a.id==="case"||a.id==="default"?(d(),f.reserve(a),a=a.std()):(l("Expected 'case' or 'default' statement but recieved '"+a.id+"'",c,2338),a=void 0);a&&b.push(a)}b=b.length===0?null:b.length===1?b[0]:b;d("}");f.pop();this.second=b;this.arity="statement";return this});w("case",function(){var b=[],a=c;d("(literal)");d(":");for(this.first=a;;){if(c.id==="default"||c.id==="case"||c.id==="}")break;(s=p())&&b.push(s)}this.second=b.length===0?null:b.length===1?b[0]:b;this.arity="statement";return this});
w("default",function(){var b=[],a=c;d(":");for(this.first=a;;){if(c.id==="}")break;else(c.id==="default"||c.id==="case")&&l("unexpected  '"+a.id+"' statement",c,2748);(s=p())&&b.push(s)}this.second=b.length===0?null:b.length===1?b[0]:b;this.arity="statement";return this});w("function",function(){var a=[];if(c.id=="(name)")f.define(c),this.name=c.value,d();h();d("(");if(c.id!==")")for(;;){c.arity!=="name"&&l("Expected a parameter name, found",c,2772);f.define(c);a.push(c);d();if(c.id!==",")break;d(",")}this.first=
a;d(")");d("{");this.second=o();d("}");this.arity="function";f.pop();return this});w("print",function(){this.first=g(0);this.arity="function";d(";");return this});w("println",function(){this.first=g(0);this.arity="function";d(";");return this});return function(a){r="";i=a;q=0;h();d();a=o();d("(end)");f.pop();return a}};var tokenizer=function(f,k){var a,c,i,q,r,l,y,j,A,h,d,g=function(a,c,d){var f="===========Tokenizer Interupted=============\n";f+="\n";f+="Syntax Error\n";f+=a+"\n";f+="ERROR CODE: "+d+"\n";c.value&&(f+="On "+c.value+" "+c.arity+"\n",f+="At Line: "+c.line+", char : "+c.at+"\n");throw f;};typeof f!=="string"&&(f="<>+-&");typeof k!=="string"&&(k="=>&:");var p=function(a,d){return{type:a,value:d,from:c,to:i,line:A,at:h}},o=function(c){i+=c>-1?c:1;h+=c>-1?c:1;a=r.charAt(i);if(a==="\n"||a==="\r")A++,h=
0};return function(v){q=v.length;r=v;i=0;A=1;h=0;d=[];if(v){for(o(0);a;)if(c=i,a<=" ")o();else if(a>="a"&&a<="z"||a>="A"&&a<="Z"){for(j=a;;)if(o(),a>="a"&&a<="z"||a>="A"&&a<="Z"||a>="0"&&a<="9"||a==="_")j+=a;else break;d.push(p("name",j))}else if(a>="0"&&a<="9"){for(j=a;;){o();if(a<"0"||a>"9")break;j+=a}if(a===".")for(j+=a;;){o();if(a<"0"||a>"9")break;j+=a}if(a==="e"||a==="E"){j+=a;o();if(a==="-"||a==="+")j+=a,o();(a<"0"||a>"9")&&g("Bad exponent",p("number",j),1132);do j+=a,o();while(a>="0"&&a<="9")}a>=
"a"&&a<="z"&&(j+=a,i+=1,g("Bad number",p("number",j),1142));l=+j;isFinite(l)?d.push(p("number",l)):g("Bad number",p("number",j),1149)}else if(a==="'"||a==='"'){j="";for(y=a;;){o();a<" "&&g(a==="\n"||a==="\r"||a===""?"Unterminated string.":"Control character in string.",p("string",j),1159);if(a===y)break;if(a==="\\")switch(i+1>=q&&g("Unterminated string",p("number",j),1166),o(),a){case "b":a="\u0008";break;case "f":a="\u000c";break;case "n":a="\n";break;case "r":a="\r";break;case "t":a="\t";break;
case "u":i>=q&&g("Unterminated string",p("number",j),1187),a=parseInt(v.substr(i+1,4),16),(!isFinite(a)||a<0)&&g("Unterminated string",p("number",j),1191),a=String.fromCharCode(a),i+=4}j+=a}d.push(p("string",j));o()}else if(a==="/"&&v.charAt(i+1)==="/")for(;;){if(o(),a==="\n"||a==="\r"||a==="")break}else if(a==="/"&&v.charAt(i+1)==="*")for(;;)if(o(),a==="*"&&v.charAt(i+1)==="/"){a=v.charAt(i+=2);break}else i>=q&&g("Unterminated Comment",p("number",j),1216);else if(f.indexOf(a)>=0){for(j=a;i<q;){o();
if(k.indexOf(a)<0)break;j+=a}d.push(p("operator",j))}else d.push(p("operator",a)),o();return d}}};var SJS=function(f){var k={},a="key,name,message,arity,value,eval,loopval,step,declareStat,first,second,third,fourth,from,to,line,at".split(",");k.ioa=f.ioa||{print:function(a){var f=document.getElementById("CONSOLE");f.innerHTML+=a;f.scrollTop=f.scrollHeight},println:function(a){var f=document.getElementById("CONSOLE");f.innerHTML+=a+"\n";f.scrollTop=f.scrollHeight},inspect:function(c){return JSON.stringify(c,a,4)}};k.tokenizer=tokenizer("=<>!+-*&|/%^~","=<>&|+-*");k.parser=parser();k.interpreter=
interpreter(k.ioa);k.go=function(c){try{var i=k.tokenizer(c),q=k.parser(i);k.interpreter(q);if(f.debug){try{parseTreestring=JSON.stringify(q,a,4)}catch(r){parseTreestring=r}document.getElementById("ASTOUTPUT").innerHTML=parseTreestring.replace(/&/g,"&amp;").replace(/[<]/g,"&lt;")}}catch(l){k.ioa.println(l)}};return k};
